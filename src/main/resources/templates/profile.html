<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>My Profile</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5" id="profileContent" style="display:none;">
    <div class="card p-4 shadow">
        <div class="d-flex align-items-center">
            <img id="profilePic" src="" class="rounded-circle" width="80">
            <div class="ms-3">
                <h2 id="displayUserName">Loading...</h2>
                <p id="displayBio" class="text-muted"></p>
            </div>
        </div>
        <div class="row mt-4 text-center">
            <div class="col">Followers: <b id="countFollowers">0</b></div>
            <div class="col">Following: <b id="countFollowing">0</b></div>
        </div>
        <button onclick="logout()" class="btn btn-danger btn-sm mt-3">Logout</button>
    </div>
</div>

<script>
    async function loadProfile() {
        const token = localStorage.getItem('socio_token');
        if (!token) {
            window.location.href = '/login';
            return;
        }

        const response = await fetch('/api/user/profile/', {
            method: 'GET',
            headers: { 'Authorization': token } // Pass token to your JwtAuthenticationFilter
        });

        const result = await response.json();
        if (result.success) {
            document.getElementById('profileContent').style.display = 'block';
            document.getElementById('displayUserName').innerText = result.data.userName;
            document.getElementById('displayBio').innerText = result.data.bio;
            document.getElementById('countFollowers').innerText = result.data.followersCount;
            document.getElementById('countFollowing').innerText = result.data.followingCount;
            document.getElementById('profilePic').src = result.data.profilePhoto || 'https://via.placeholder.com/80';
        } else {
            localStorage.removeItem('socio_token');
            window.location.href = '/login';
        }
    }

    function logout() {
        localStorage.removeItem('socio_token');
        window.location.href = '/login';
    }

    window.onload = loadProfile;
</script>
</body>
</html>